<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Finance News FYP</title>
  <style>
    :root {
      --tiktok-pink: #FF0050;
      --tiktok-blue: #00F2EA;
      --dark-bg: #000;
      --card-bg: #1a1a1a;
      --text-primary: #fff;
      --text-secondary: #aaa;
    }

    body {
      font-family: 'Proxima Nova', Arial, sans-serif;
      margin: 0;
      background: var(--dark-bg);
      color: var(--text-primary);
      overflow-x: hidden;
    }

    .search-container {
      position: fixed;
      top: 10px;
      width: 100%;
      z-index: 100;
      padding: 0 20px;
      box-sizing: border-box;
      backdrop-filter: blur(10px);
    }

    /* Style for autocomplete suggestions */
    #autocompleteSuggestions {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      max-width: 500px;
      width: 100%;
      background: var(--card-bg);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      overflow: hidden;
      z-index: 101;
    }

    #autocompleteSuggestions div {
      padding: 10px;
      cursor: pointer;
    }

    #autocompleteSuggestions div:hover {
      background: rgba(255,255,255,0.1);
    }

    #searchForm {
      display: flex;
      gap: 10px;
      max-width: 500px;
      margin: 0 auto;
      background: rgba(255,255,255,0.05);
      border-radius: 30px;
      padding: 5px;
      transition: transform 0.3s;
      position: relative;
    }

    #searchForm:hover {
      transform: scale(1.02);
    }

    #symbolInput {
      flex: 1;
      padding: 12px 20px;
      border: none;
      background: transparent;
      color: var(--text-primary);
      font-size: 16px;
    }

    #symbolInput:focus {
      outline: none;
    }

    #symbolInput::placeholder {
      color: rgba(255,255,255,0.7);
    }

    button {
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      background: linear-gradient(45deg, var(--tiktok-pink), var(--tiktok-blue));
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button:hover {
      opacity: 0.9;
      box-shadow: 0 0 15px rgba(255,0,80,0.3);
    }

    .card-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      padding: 80px 20px 20px;
    }

    .card {
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      min-height: 90vh;
      background: var(--card-bg);
      transition: transform 0.3s;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0) 60%, rgba(0,0,0,0.8) 100%);
      pointer-events: none;
    }

    .card img {
      width: 100%;
      height: 60vh;
      object-fit: cover;
      transition: transform 0.3s;
    }

    .card:hover img {
      transform: scale(1.02);
    }

    .card-content {
      padding: 20px;
      position: relative;
      z-index: 1;
    }

    .card-title {
      font-size: 1.5em;
      margin: 0 0 15px;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      font-size: 0.9em;
      opacity: 0.8;
    }

    .card-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 25px;
      background: linear-gradient(45deg, var(--tiktok-pink), var(--tiktok-blue));
      color: white;
      text-decoration: none;
      border-radius: 25px;
      font-weight: bold;
      transition: transform 0.2s;
    }

    .card-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .card-actions button {
      padding: 10px 20px;
      border-radius: 20px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
      color: var(--text-primary);
    }

    .card-actions button:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-2px);
    }

    .saved-news-drawer {
      position: fixed;
      top: 0;
      right: -320px;
      width: 320px;
      height: 100%;
      background: var(--card-bg);
      border-left: 1px solid rgba(255,255,255,0.1);
      transition: right 0.3s ease;
      padding: 20px;
      z-index: 200;
      overflow-y: auto;
    }

    .saved-news-drawer.open {
      right: 0;
    }

    .drawer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .close-drawer {
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 20px;
      cursor: pointer;
      padding: 5px;
    }

    .open-drawer {
      position: fixed;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      background: linear-gradient(45deg, var(--tiktok-pink), var(--tiktok-blue));
      border: none;
      border-radius: 50%;
      padding: 15px;
      color: white;
      cursor: pointer;
      z-index: 150;
      transition: transform 0.3s;
    }

    .open-drawer:hover {
      transform: translateY(-50%) scale(1.1);
    }

    .saved-news-item {
      padding: 15px;
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      margin-bottom: 15px;
      transition: all 0.2s;
    }

    .saved-news-item:hover {
      background: rgba(255,255,255,0.1);
    }

    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--card-bg);
      padding: 15px 25px;
      border-radius: 25px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      animation: slideUp 0.3s ease-out;
      z-index: 300;
    }

    @keyframes slideUp {
      from { bottom: -50px; opacity: 0; }
      to { bottom: 20px; opacity: 1; }
    }

    .progress-bar {
      height: 3px;
      background: rgba(255,255,255,0.2);
      position: relative;
      margin-top: 10px;
      border-radius: 2px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--tiktok-pink), var(--tiktok-blue));
      width: 100%;
      animation: progress 3s linear forwards;
    }

    @keyframes progress {
      from { width: 100%; }
      to { width: 0; }
    }

    /* Mobile adjustments */
    @media (max-width: 600px) {
      #searchForm {
        max-width: 90%;
        padding: 8px 10px;
      }
      #symbolInput {
        padding: 10px 15px;
        font-size: 14px;
      }
      .card-container {
        padding: 100px 10px 20px;
      }
      .card {
        min-height: 70vh;
      }
      .card img {
        height: 40vh;
      }
      .card-title {
        font-size: 1.3em;
      }
      .card-actions button {
        padding: 8px 15px;
        font-size: 0.9em;
      }
      .open-drawer {
        top: 90%;
        right: 10px;
        transform: translateY(-90%);
      }
      .saved-news-drawer {
        width: 100%;
        right: -100%;
      }
      .saved-news-drawer.open {
        right: 0;
      }
    }
  </style>
</head>
<body>
  <!-- Search Section with Autocomplete -->
  <div class="search-container">
    <form id="searchForm">
      <input type="text" id="symbolInput" placeholder="üìà Enter tickers (AAPL, TSLA, ...)" required />
      <button type="submit">üöÄ Go</button>
      <!-- Autocomplete suggestions will appear here -->
      <div id="autocompleteSuggestions"></div>
    </form>
  </div>

  <button id="openDrawer" class="open-drawer">üìÅ</button>

  <div id="savedNewsDrawer" class="saved-news-drawer">
    <div class="drawer-header">
      <h2>Saved News</h2>
      <button id="closeDrawer" class="close-drawer">‚úï</button>
    </div>
    <div id="savedNewsContainer" class="saved-news-container"></div>
  </div>

  <div id="cardContainer" class="card-container"></div>
  <div id="toastContainer"></div>

  <script>
    // API credentials and endpoints
    const baseUrl = 'https://yahoo-finance166.p.rapidapi.com/api/news/list-by-symbol';
    const autocompleteUrl = 'https://yahoo-finance166.p.rapidapi.com/api/autocomplete';
    const region = 'US';
    const snippetCount = 500;
    const apiKey = '60c4b7c12emshfe21a6a1ec58d8bp1a396cjsn6bc88b0f02f5';
    const apiHost = 'yahoo-finance166.p.rapidapi.com';

    /* 
      Example cURL command for autocomplete:
      curl --request GET \
        --url 'https://yahoo-finance166.p.rapidapi.com/api/autocomplete?query=AA' \
        --header 'x-rapidapi-host: yahoo-finance166.p.rapidapi.com' \
        --header 'x-rapidapi-key: 60c4b7c12emshfe21a6a1ec58d8bp1a396cjsn6bc88b0f02f5'
    */

    async function fetchNews(symbols) {
      const url = `${baseUrl}?s=${encodeURIComponent(symbols)}&region=${region}&snippetCount=${snippetCount}`;
      try {
        const container = document.getElementById('cardContainer');
        container.innerHTML = Array(3).fill('<div class="card loading-card"></div>').join('');
        
        const response = await fetch(url, {
          method: 'GET',
          headers: {
            'x-rapidapi-key': apiKey,
            'x-rapidapi-host': apiHost
          }
        });
        const data = await response.json();
        renderCards(data);
      } catch (error) {
        showToast('‚ö†Ô∏è Error loading content', '‚ö†Ô∏è');
        console.error('Error:', error);
      }
    }

    // Autocomplete: fetch suggestions based on query
    async function fetchAutocomplete(query) {
      const url = `${autocompleteUrl}?query=${encodeURIComponent(query)}`;
      try {
        const response = await fetch(url, {
          method: 'GET',
          headers: {
            'x-rapidapi-key': apiKey,
            'x-rapidapi-host': apiHost
          }
        });
        return await response.json();
      } catch (error) {
        console.error('Autocomplete error:', error);
        return {};
      }
    }

    function renderAutocompleteSuggestions(data) {
      const suggestionsContainer = document.getElementById('autocompleteSuggestions');
      suggestionsContainer.innerHTML = '';
      // Assuming the response contains a "quotes" array
      if (data.quotes && data.quotes.length > 0) {
        data.quotes.forEach(quote => {
          const suggestion = document.createElement('div');
          suggestion.textContent = `${quote.symbol} - ${quote.shortname || quote.longname || ''}`;
          suggestion.addEventListener('click', () => {
            document.getElementById('symbolInput').value = quote.symbol;
            suggestionsContainer.innerHTML = '';
          });
          suggestionsContainer.appendChild(suggestion);
        });
      }
    }

    // Listen to input events to trigger autocomplete
    document.getElementById('symbolInput').addEventListener('input', async function() {
      const query = this.value.trim();
      if (query.length >= 1) {
        const data = await fetchAutocomplete(query);
        renderAutocompleteSuggestions(data);
      } else {
        document.getElementById('autocompleteSuggestions').innerHTML = '';
      }
    });

    function renderCards(data) {
      const container = document.getElementById('cardContainer');
      container.innerHTML = '';
      const newsItems = (data?.data?.main?.stream) || [];
      
      if (newsItems.length === 0) {
        container.innerHTML = '<div class="card"><div class="card-content"><h2>üì∞ No news found</h2></div></div>';
        return;
      }

      newsItems.forEach(item => {
        const title = item.content?.title || "No title available";
        const pubDate = item.content?.pubDate ? new Date(item.content.pubDate).toLocaleString() : "Just now";
        const link = item.content?.clickThroughUrl?.url || "#";
        const thumb = item.content?.thumbnail?.resolutions?.[0]?.url || "";
        const provider = item.content?.provider?.displayName || "Unknown Source";

        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          ${thumb ? `<img src="${thumb}" alt="News thumbnail" loading="lazy">` : ''}
          <div class="card-content">
            <h2 class="card-title">${title}</h2>
            <div class="card-meta">
              <span>‚è≥ ${pubDate}</span>
              <span>üìå ${provider}</span>
            </div>
            <div class="card-actions"></div>
          </div>
        `;

        const actionsDiv = card.querySelector('.card-actions');
        actionsDiv.appendChild(createActionButton('üíæ Save', () => saveNews({
          title, pubDate, link, thumb, provider
        })));
        actionsDiv.appendChild(createActionButton('üîó Share', () => handleShare(link, title)));
        actionsDiv.appendChild(createActionButton('üìñ Read', () => window.open(link, '_blank')));

        container.appendChild(card);
      });

      initImageTransitions();
    }

    function createActionButton(text, onClick) {
      const button = document.createElement('button');
      button.textContent = text;
      button.addEventListener('click', onClick);
      return button;
    }

    function handleShare(link, title) {
      if (navigator.share) {
        navigator.share({ title, text: title, url: link })
          .catch(err => showToast('Error sharing', '‚ö†Ô∏è'));
      } else {
        navigator.clipboard.writeText(link)
          .then(() => showToast('üîó Link copied', 'üìã'))
          .catch(() => showToast('Sharing not supported', '‚ö†Ô∏è'));
      }
    }

    function saveNews(newsData) {
      const saved = JSON.parse(localStorage.getItem('savedNews')) || [];
      if (!saved.some(item => item.link === newsData.link)) {
        saved.push(newsData);
        localStorage.setItem('savedNews', JSON.stringify(saved));
        showToast('üíæ News saved', '‚úÖ');
        updateSavedNewsDrawer();
      } else {
        showToast('‚ö†Ô∏è Already saved', '‚ÑπÔ∏è');
      }
    }

    function showToast(message, icon = '‚ÑπÔ∏è') {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.innerHTML = `
        <span>${icon}</span>
        ${message}
        <div class="progress-bar"><div class="progress-fill"></div></div>
      `;
      document.getElementById('toastContainer').appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function updateSavedNewsDrawer() {
      const container = document.getElementById('savedNewsContainer');
      const saved = JSON.parse(localStorage.getItem('savedNews')) || [];
      container.innerHTML = saved.map((item, index) => `
        <div class="saved-news-item">
          <h3>${item.title}</h3>
          <p><small>‚è≥ ${item.pubDate}</small></p>
          <div class="card-actions">
            <button onclick="window.open('${item.link}', '_blank')">üìñ Read</button>
            <button class="remove-saved" data-index="${index}">üóëÔ∏è Remove</button>
          </div>
        </div>
      `).join('');
      setupSavedNewsEvents();
    }

    function setupSavedNewsEvents() {
      document.querySelectorAll('.remove-saved').forEach(button => {
        button.addEventListener('click', (e) => {
          const index = e.target.dataset.index;
          const saved = JSON.parse(localStorage.getItem('savedNews'));
          saved.splice(index, 1);
          localStorage.setItem('savedNews', JSON.stringify(saved));
          updateSavedNewsDrawer();
          showToast('üóëÔ∏è News removed', '‚úÖ');
        });
      });
    }

    function initImageTransitions() {
      document.querySelectorAll('img').forEach(img => {
        img.style.opacity = '0';
        img.addEventListener('load', () => {
          img.style.transition = 'opacity 0.3s';
          img.style.opacity = '1';
        });
      });
    }

    // Event Listeners
    document.getElementById('openDrawer').addEventListener('click', () => {
      document.getElementById('savedNewsDrawer').classList.add('open');
      updateSavedNewsDrawer();
    });

    document.getElementById('closeDrawer').addEventListener('click', () => {
      document.getElementById('savedNewsDrawer').classList.remove('open');
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        document.getElementById('savedNewsDrawer').classList.remove('open');
      }
    });

    document.getElementById('searchForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const symbols = document.getElementById('symbolInput').value.trim();
      if (symbols) fetchNews(symbols);
    });

    // Initial Load
    fetchNews('AAPL,GOOGL,TSLA');
  </script>
</body>
</html>
